<template>
  <DocShell type="tech" :title="t('database.title')" :description="t('database.description')">
    <div class="prose prose-slate max-w-none dark:prose-invert">
      <h1>Base de donn√©es</h1>
      
      <div class="not-prose bg-gradient-to-br from-cyan-50 to-blue-50 dark:from-cyan-950/20 dark:to-blue-950/20 rounded-2xl p-8 mb-12 border border-cyan-200/50 dark:border-cyan-800/30">
        <h2 class="text-2xl font-bold text-slate-900 dark:text-white mb-4">üíæ Architecture donn√©es relationnelle</h2>
        <p class="text-slate-700 dark:text-slate-300 leading-relaxed mb-6">
          Base de donn√©es MySQL 8.0 con√ßue pour performance, int√©grit√© et √©volutivit√©. 
          Structure optimis√©e pour gestion d'entreprise-r√©sidence avec relations complexes et contraintes m√©tier.
        </p>
        <div class="grid md:grid-cols-3 gap-4">
          <div class="bg-white/50 dark:bg-slate-800/50 rounded-xl p-4">
            <h3 class="font-bold text-cyan-900 dark:text-cyan-200 mb-2">üèóÔ∏è Structure</h3>
            <p class="text-sm text-slate-600 dark:text-slate-300">12 tables principales + indexes</p>
          </div>
          <div class="bg-white/50 dark:bg-slate-800/50 rounded-xl p-4">
            <h3 class="font-bold text-cyan-900 dark:text-cyan-200 mb-2">üîó Relations</h3>
            <p class="text-sm text-slate-600 dark:text-slate-300">Int√©grit√© r√©f√©rentielle stricte</p>
          </div>
          <div class="bg-white/50 dark:bg-slate-800/50 rounded-xl p-4">
            <h3 class="font-bold text-cyan-900 dark:text-cyan-200 mb-2">‚ö° Performance</h3>
            <p class="text-sm text-slate-600 dark:text-slate-300">Optimisations requ√™tes complexes</p>
          </div>
        </div>
      </div>

      <!-- Sch√©ma g√©n√©ral -->
      <h2>Sch√©ma de base de donn√©es</h2>
      
      <h3>Vue d'ensemble des tables</h3>
      <p>Architecture relationnelle avec 18 tables principales organis√©es par domaine fonctionnel :</p>
      
      <div class="not-prose bg-gray-50 dark:bg-gray-800/50 rounded-xl p-6 my-6 border border-gray-200 dark:border-gray-700">
        <h4 class="font-bold text-gray-800 dark:text-gray-200 mb-4">üìä Tables par domaine</h4>
        <div class="grid md:grid-cols-2 gap-6 text-sm">
          <div>
            <h5 class="font-semibold text-gray-900 dark:text-gray-200 mb-3">üë• Gestion Utilisateurs</h5>
            <ul class="space-y-2 text-gray-600 dark:text-gray-300">
              <li>‚Ä¢ <strong>personne</strong> : Comptes utilisateurs principaux</li>
              <li>‚Ä¢ <strong>admin</strong> : Comptes administrateurs</li>
              <li>‚Ä¢ <strong>gardien</strong> : Comptes gardiens</li>
              <li>‚Ä¢ <strong>resident</strong> : Comptes r√©sidents</li>
              <li>‚Ä¢ <strong>invite</strong> : Comptes invit√©s temporaires</li>
              <li>‚Ä¢ <strong>ban</strong> : Utilisateurs bannis</li>
            </ul>
          </div>
          <div>
            <h5 class="font-semibold text-gray-900 dark:text-gray-200 mb-3">üè¢ Gestion R√©sidence</h5>
            <ul class="space-y-2 text-gray-600 dark:text-gray-300">
              <li>‚Ä¢ <strong>badge</strong> : Badges d'acc√®s physique</li>
              <li>‚Ä¢ <strong>suivi_badge</strong> : Historique utilisation badges</li>
              <li>‚Ä¢ <strong>incident</strong> : Incidents et demandes</li>
              <li>‚Ä¢ <strong>visite</strong> : Planification visites</li>
              <li>‚Ä¢ <strong>groupe_message</strong> : Groupes de conversation</li>
              <li>‚Ä¢ <strong>message</strong> : Messages dans groupes</li>
              <li>‚Ä¢ <strong>message_fichier</strong> : Pi√®ces jointes</li>
              <li>‚Ä¢ <strong>message_reaction</strong> : R√©actions aux messages</li>
              <li>‚Ä¢ <strong>personne_groupe</strong> : Participants aux groupes</li>
              <li>‚Ä¢ <strong>logs</strong> : Journal d'activit√© syst√®me</li>
              <li>‚Ä¢ <strong>app_settings</strong> : Configuration application</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Tables d√©taill√©es -->
      <h2>Structure d√©taill√©e des tables</h2>
      
      <h3>Table personne - Utilisateurs</h3>
      <p>Table centrale pour gestion des comptes utilisateurs avec authentification Laravel Sanctum :</p>
      
      <div class="not-prose bg-blue-50 dark:bg-blue-950/20 rounded-xl p-6 my-6 border border-blue-200 dark:border-blue-800/30">
        <h4 class="font-bold text-blue-800 dark:text-blue-200 mb-4">üë§ Structure table personne</h4>
        <div class="overflow-x-auto">
          <table class="w-full text-sm border-collapse border border-blue-200 dark:border-blue-700">
            <thead class="bg-blue-100 dark:bg-blue-900/50">
              <tr>
                <th class="border border-blue-200 dark:border-blue-700 p-3 text-left font-semibold text-blue-900 dark:text-blue-200">Champ</th>
                <th class="border border-blue-200 dark:border-blue-700 p-3 text-left font-semibold text-blue-900 dark:text-blue-200">Type</th>
                <th class="border border-blue-200 dark:border-blue-700 p-3 text-left font-semibold text-blue-900 dark:text-blue-200">Contraintes</th>
                <th class="border border-blue-200 dark:border-blue-700 p-3 text-left font-semibold text-blue-900 dark:text-blue-200">Description</th>
              </tr>
            </thead>
            <tbody class="text-blue-700 dark:text-blue-300">
              <tr>
                <td class="border border-blue-200 dark:border-blue-700 p-3"><code>id_personne</code></td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">INT AUTO_INCREMENT</td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">PRIMARY KEY</td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">Identifiant unique</td>
              </tr>
              <tr class="bg-blue-25 dark:bg-blue-950/20">
                <td class="border border-blue-200 dark:border-blue-700 p-3"><code>email</code></td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">VARCHAR(255)</td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">UNIQUE, NOT NULL</td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">Email unique d'identification</td>
              </tr>
              <tr>
                <td class="border border-blue-200 dark:border-blue-700 p-3"><code>mot_de_passe</code></td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">VARCHAR(255)</td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">NOT NULL</td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">Mot de passe hash√© (bcrypt)</td>
              </tr>
              <tr class="bg-blue-25 dark:bg-blue-950/20">
                <td class="border border-blue-200 dark:border-blue-700 p-3"><code>nom</code></td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">VARCHAR(100)</td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">NOT NULL</td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">Nom de famille</td>
              </tr>
              <tr>
                <td class="border border-blue-200 dark:border-blue-700 p-3"><code>prenom</code></td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">VARCHAR(100)</td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">NOT NULL</td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">Pr√©nom</td>
              </tr>
              <tr class="bg-blue-25 dark:bg-blue-950/20">
                <td class="border border-blue-200 dark:border-blue-700 p-3"><code>numero_telephone</code></td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">VARCHAR(20)</td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">NULL</td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">Num√©ro de t√©l√©phone</td>
              </tr>
              <tr>
                <td class="border border-blue-200 dark:border-blue-700 p-3"><code>photo_profil</code></td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">VARCHAR(255)</td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">NULL</td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">URL photo de profil</td>
              </tr>
              <tr class="bg-blue-25 dark:bg-blue-950/20">
                <td class="border border-blue-200 dark:border-blue-700 p-3"><code>email_verified_at</code></td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">TIMESTAMP</td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">NULL</td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">Date v√©rification email</td>
              </tr>
              <tr>
                <td class="border border-blue-200 dark:border-blue-700 p-3"><code>remember_token</code></td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">VARCHAR(100)</td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">NULL</td>
                <td class="border border-blue-200 dark:border-blue-700 p-3">Token "Se souvenir de moi"</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <h3>Tables de r√¥les (admin, gardien, resident, invite)</h3>
      <p>Syst√®me de r√¥les par tables sp√©cialis√©es avec relations vers personne :</p>
      
      <div class="not-prose bg-green-50 dark:bg-green-950/20 rounded-xl p-6 my-6 border border-green-200 dark:border-green-800/30">
        <h4 class="font-bold text-green-800 dark:text-green-200 mb-4">üè∑Ô∏è Tables de r√¥les utilisateurs</h4>
        <div class="grid md:grid-cols-2 gap-4 text-sm">
          <div>
            <h5 class="font-semibold text-green-900 dark:text-green-200 mb-2">Table admin</h5>
            <ul class="space-y-1 text-green-700 dark:text-green-300">
              <li>‚Ä¢ <code>id_admin</code> : Identifiant unique (PK)</li>
              <li>‚Ä¢ <code>id_personne</code> : R√©f√©rence personne (FK)</li>
              <li>‚Ä¢ <code>niveau_acces</code> : Niveau privil√®ges</li>
              <li>‚Ä¢ <code>date_nomination</code> : Date promotion admin</li>
            </ul>
            <h5 class="font-semibold text-green-900 dark:text-green-200 mb-2 mt-4">Table gardien</h5>
            <ul class="space-y-1 text-green-700 dark:text-green-300">
              <li>‚Ä¢ <code>id_gardien</code> : Identifiant unique (PK)</li>
              <li>‚Ä¢ <code>id_personne</code> : R√©f√©rence personne (FK)</li>
            </ul>
          </div>
          <div>
            <h5 class="font-semibold text-green-900 dark:text-green-200 mb-2">Table resident</h5>
            <ul class="space-y-1 text-green-700 dark:text-green-300">
              <li>‚Ä¢ <code>id_resident</code> : Identifiant unique (PK)</li>
              <li>‚Ä¢ <code>id_personne</code> : R√©f√©rence personne (FK)</li>
              <li>‚Ä¢ <code>adresse_logement</code> : Adresse appartement</li>
              <li>‚Ä¢ <code>date_emmenagement</code> : Date d'arriv√©e</li>
            </ul>
            <h5 class="font-semibold text-green-900 dark:text-green-200 mb-2 mt-4">Table invite</h5>
            <ul class="space-y-1 text-green-700 dark:text-green-300">
              <li>‚Ä¢ <code>id_invite</code> : Identifiant unique (PK)</li>
              <li>‚Ä¢ <code>id_personne</code> : R√©f√©rence personne (FK)</li>
              <li>‚Ä¢ <code>date_debut_sejour</code> : D√©but autorisation</li>
              <li>‚Ä¢ <code>date_fin_sejour</code> : Fin autorisation</li>
              <li>‚Ä¢ <code>statut</code> : actif|expir√©|r√©voqu√©</li>
            </ul>
          </div>
        </div>
      </div>

      <h3>Table incident - Gestion d'incidents</h3>
      <p>Workflow complet de traitement des incidents et demandes avec pi√®ces jointes :</p>
      
      <div class="not-prose bg-orange-50 dark:bg-orange-950/20 rounded-xl p-6 my-6 border border-orange-200 dark:border-orange-800/30">
        <h4 class="font-bold text-orange-800 dark:text-orange-200 mb-4">üö® Structure table incident</h4>
        <div class="grid md:grid-cols-2 gap-4 text-sm">
          <div>
            <h5 class="font-semibold text-orange-900 dark:text-orange-200 mb-2">Identification</h5>
            <ul class="space-y-1 text-orange-700 dark:text-orange-300">
              <li>‚Ä¢ <code>id</code> : Identifiant unique (PK)</li>
              <li>‚Ä¢ <code>id_signaleur</code> : Utilisateur d√©clarant (FK)</li>
              <li>‚Ä¢ <code>object</code> : Titre/objet de l'incident</li>
              <li>‚Ä¢ <code>datetime</code> : Date/heure signalement</li>
              <li>‚Ä¢ <code>pieces_jointes</code> : JSON fichiers attach√©s</li>
            </ul>
          </div>
          <div>
            <h5 class="font-semibold text-orange-900 dark:text-orange-200 mb-2">Workflow</h5>
            <ul class="space-y-1 text-orange-700 dark:text-orange-300">
              <li>‚Ä¢ <code>statut</code> : ouvert|en_cours|r√©solu|ferm√©</li>
              <li>‚Ä¢ Syst√®me de notification automatique</li>
              <li>‚Ä¢ Support pi√®ces jointes (photos, documents)</li>
              <li>‚Ä¢ Tra√ßabilit√© compl√®te des actions</li>
              <li>‚Ä¢ Assignation automatique par r√¥le</li>
            </ul>
          </div>
        </div>
      </div>

      <h3>Syst√®me de messagerie (groupe_message, message, message_fichier)</h3>
      <p>Architecture compl√®te de messagerie en groupes avec pi√®ces jointes et r√©actions :</p>
      
      <div class="not-prose bg-purple-50 dark:bg-purple-950/20 rounded-xl p-6 my-6 border border-purple-200 dark:border-purple-800/30">
        <h4 class="font-bold text-purple-800 dark:text-purple-200 mb-4">üí¨ Structure syst√®me messagerie</h4>
        <div class="overflow-x-auto">
          <table class="w-full text-sm border-collapse border border-purple-200 dark:border-purple-700">
            <thead class="bg-purple-100 dark:bg-purple-900/50">
              <tr>
                <th class="border border-purple-200 dark:border-purple-700 p-3 text-left font-semibold text-purple-900 dark:text-purple-200">Table</th>
                <th class="border border-purple-200 dark:border-purple-700 p-3 text-left font-semibold text-purple-900 dark:text-purple-200">Champs principaux</th>
                <th class="border border-purple-200 dark:border-purple-700 p-3 text-left font-semibold text-purple-900 dark:text-purple-200">Description</th>
              </tr>
            </thead>
            <tbody class="text-purple-700 dark:text-purple-300">
              <tr>
                <td class="border border-purple-200 dark:border-purple-700 p-3"><strong>groupe_message</strong></td>
                <td class="border border-purple-200 dark:border-purple-700 p-3">
                  <code>id_groupe_message</code>, <code>nom_groupe</code>, <code>date_creation</code>
                </td>
                <td class="border border-purple-200 dark:border-purple-700 p-3">Groupes de conversation</td>
              </tr>
              <tr class="bg-purple-25 dark:bg-purple-950/20">
                <td class="border border-purple-200 dark:border-purple-700 p-3"><strong>message</strong></td>
                <td class="border border-purple-200 dark:border-purple-700 p-3">
                  <code>id_message</code>, <code>id_groupe_message</code>, <code>id_auteur</code>, <code>contenu_message</code>, <code>date_envoi</code>, <code>a_fichiers</code>, <code>reply_to</code>
                </td>
                <td class="border border-purple-200 dark:border-purple-700 p-3">Messages dans groupes avec support replies</td>
              </tr>
              <tr>
                <td class="border border-purple-200 dark:border-purple-700 p-3"><strong>message_fichier</strong></td>
                <td class="border border-purple-200 dark:border-purple-700 p-3">
                  <code>id_fichier</code>, <code>id_message</code>, <code>nom_fichier</code>, <code>nom_original</code>, <code>chemin_fichier</code>, <code>type_fichier</code>, <code>taille_fichier</code>
                </td>
                <td class="border border-purple-200 dark:border-purple-700 p-3">Pi√®ces jointes aux messages</td>
              </tr>
              <tr class="bg-purple-25 dark:bg-purple-950/20">
                <td class="border border-purple-200 dark:border-purple-700 p-3"><strong>message_reaction</strong></td>
                <td class="border border-purple-200 dark:border-purple-700 p-3">
                  <code>id_reaction</code>, <code>id_message</code>, <code>id_personne</code>, <code>emoji</code>, <code>date_reaction</code>
                </td>
                <td class="border border-purple-200 dark:border-purple-700 p-3">R√©actions emoji aux messages</td>
              </tr>
              <tr>
                <td class="border border-purple-200 dark:border-purple-700 p-3"><strong>personne_groupe</strong></td>
                <td class="border border-purple-200 dark:border-purple-700 p-3">
                  <code>id_personne</code>, <code>id_groupe_message</code>, <code>date_adhesion</code>, <code>derniere_connexion</code>
                </td>
                <td class="border border-purple-200 dark:border-purple-700 p-3">Participants aux groupes</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <h3>Table visite - Planification et gestion des visites</h3>
      <p>Syst√®me complet de gestion des visites avec statuts et historique :</p>
      
      <div class="not-prose bg-cyan-50 dark:bg-cyan-950/20 rounded-xl p-6 my-6 border border-cyan-200 dark:border-cyan-800/30">
        <h4 class="font-bold text-cyan-800 dark:text-cyan-200 mb-4">üö™ Structure table visite</h4>
        <div class="grid md:grid-cols-2 gap-4 text-sm">
          <div>
            <h5 class="font-semibold text-cyan-900 dark:text-cyan-200 mb-2">Identification</h5>
            <ul class="space-y-1 text-cyan-700 dark:text-cyan-300">
              <li>‚Ä¢ <code>id_visite</code> : Identifiant unique (PK)</li>
              <li>‚Ä¢ <code>id_invite</code> : Personne invit√©e (FK)</li>
              <li>‚Ä¢ <code>email_visiteur</code> : Email du visiteur</li>
              <li>‚Ä¢ <code>motif_visite</code> : Motif de la visite</li>
            </ul>
          </div>
          <div>
            <h5 class="font-semibold text-cyan-900 dark:text-cyan-200 mb-2">Planning</h5>
            <ul class="space-y-1 text-cyan-700 dark:text-cyan-300">
              <li>‚Ä¢ <code>date_visite_start</code> : D√©but visite</li>
              <li>‚Ä¢ <code>date_visite_end</code> : Fin visite</li>
              <li>‚Ä¢ <code>statut_visite</code> : programmee|en_cours|terminee|annulee</li>
              <li>‚Ä¢ Support export PDF du planning</li>
            </ul>
          </div>
        </div>
      </div>

      <h3>Syst√®me badges (badge, suivi_badge)</h3>
      <p>Gestion compl√®te des badges d'acc√®s avec tra√ßabilit√© :</p>
      
      <div class="not-prose bg-teal-50 dark:bg-teal-950/20 rounded-xl p-6 my-6 border border-teal-200 dark:border-teal-800/30">
        <h4 class="font-bold text-teal-800 dark:text-teal-200 mb-4">üè∑Ô∏è Structure syst√®me badges</h4>
        <div class="grid md:grid-cols-2 gap-4 text-sm">
          <div>
            <h5 class="font-semibold text-teal-900 dark:text-teal-200 mb-2">Table badge</h5>
            <ul class="space-y-1 text-teal-700 dark:text-teal-300">
              <li>‚Ä¢ <code>numero</code> : Num√©ro badge (PK)</li>
              <li>‚Ä¢ <code>statut</code> : actif|inactif|perdu|r√©voqu√©</li>
              <li>‚Ä¢ <code>id_proprietaire</code> : Propri√©taire actuel</li>
              <li>‚Ä¢ <code>date_creation</code> : Date d'√©mission</li>
              <li>‚Ä¢ <code>date_expiration</code> : Date expiration</li>
            </ul>
          </div>
          <div>
            <h5 class="font-semibold text-teal-900 dark:text-teal-200 mb-2">Table suivi_badge</h5>
            <ul class="space-y-1 text-teal-700 dark:text-teal-300">
              <li>‚Ä¢ <code>id</code> : Identifiant unique (PK)</li>
              <li>‚Ä¢ <code>id_badge</code> : R√©f√©rence badge (FK)</li>
              <li>‚Ä¢ <code>action</code> : Type d'action effectu√©e</li>
              <li>‚Ä¢ <code>date_heure</code> : Horodatage action</li>
              <li>‚Ä¢ <code>id_utilisateur_action</code> : Qui a fait l'action</li>
              <li>‚Ä¢ <code>message</code> : D√©tails de l'action</li>
              <li>‚Ä¢ <code>details_technique</code> : JSON donn√©es techniques</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Relations et int√©grit√© -->
      <h2>Relations et int√©grit√© r√©f√©rentielle</h2>
      
      <h3>Contraintes de cl√©s √©trang√®res</h3>
      <p>Relations strictes pour garantir la coh√©rence des donn√©es :</p>
      
      <div class="not-prose bg-red-50 dark:bg-red-950/20 rounded-xl p-6 my-6 border border-red-200 dark:border-red-800/30">
        <h4 class="font-bold text-red-800 dark:text-red-200 mb-4">üîó Relations principales</h4>
        <div class="space-y-4 text-sm">
          <div class="bg-red-100 dark:bg-red-900/30 rounded-lg p-4 border border-red-200 dark:border-red-800">
            <h5 class="font-semibold text-red-900 dark:text-red-200 mb-2">üë§ Gestion utilisateurs et r√¥les</h5>
            <ul class="text-red-700 dark:text-red-300 space-y-1">
              <li>‚Ä¢ <code>admin.id_personne</code> ‚Üí <code>personne.id_personne</code> (CASCADE DELETE)</li>
              <li>‚Ä¢ <code>gardien.id_personne</code> ‚Üí <code>personne.id_personne</code> (CASCADE DELETE)</li>
              <li>‚Ä¢ <code>resident.id_personne</code> ‚Üí <code>personne.id_personne</code> (CASCADE DELETE)</li>
              <li>‚Ä¢ <code>invite.id_personne</code> ‚Üí <code>personne.id_personne</code> (CASCADE DELETE)</li>
              <li>‚Ä¢ <code>ban.id_proprietaire</code> ‚Üí <code>personne.id_personne</code> (CASCADE DELETE)</li>
            </ul>
          </div>
          <div class="bg-orange-100 dark:bg-orange-900/30 rounded-lg p-4 border border-orange-200 dark:border-orange-800">
            <h5 class="font-semibold text-orange-900 dark:text-orange-200 mb-2">üè∑Ô∏è Badges et acc√®s</h5>
            <ul class="text-orange-700 dark:text-orange-300 space-y-1">
              <li>‚Ä¢ <code>badge.id_proprietaire</code> ‚Üí <code>personne.id_personne</code> (SET NULL)</li>
              <li>‚Ä¢ <code>suivi_badge.id_badge</code> ‚Üí <code>badge.numero</code> (CASCADE DELETE)</li>
              <li>‚Ä¢ <code>suivi_badge.id_utilisateur_action</code> ‚Üí <code>personne.id_personne</code> (SET NULL)</li>
              <li>‚Ä¢ <code>visite.id_invite</code> ‚Üí <code>personne.id_personne</code> (CASCADE DELETE)</li>
            </ul>
          </div>
          <div class="bg-blue-100 dark:bg-blue-900/30 rounded-lg p-4 border border-blue-200 dark:border-blue-800">
            <h5 class="font-semibold text-blue-900 dark:text-blue-200 mb-2">üö® Incidents et messagerie</h5>
            <ul class="text-blue-700 dark:text-blue-300 space-y-1">
              <li>‚Ä¢ <code>incident.id_signaleur</code> ‚Üí <code>personne.id_personne</code> (CASCADE DELETE)</li>
              <li>‚Ä¢ <code>message.id_auteur</code> ‚Üí <code>personne.id_personne</code> (CASCADE DELETE)</li>
              <li>‚Ä¢ <code>message.id_groupe_message</code> ‚Üí <code>groupe_message.id_groupe_message</code> (CASCADE DELETE)</li>
              <li>‚Ä¢ <code>message_fichier.id_message</code> ‚Üí <code>message.id_message</code> (CASCADE DELETE)</li>
              <li>‚Ä¢ <code>message_reaction.id_message</code> ‚Üí <code>message.id_message</code> (CASCADE DELETE)</li>
              <li>‚Ä¢ <code>message_reaction.id_personne</code> ‚Üí <code>personne.id_personne</code> (CASCADE DELETE)</li>
              <li>‚Ä¢ <code>personne_groupe.id_personne</code> ‚Üí <code>personne.id_personne</code> (CASCADE DELETE)</li>
              <li>‚Ä¢ <code>personne_groupe.id_groupe_message</code> ‚Üí <code>groupe_message.id_groupe_message</code> (CASCADE DELETE)</li>
            </ul>
          </div>
          <div class="bg-purple-100 dark:bg-purple-900/30 rounded-lg p-4 border border-purple-200 dark:border-purple-800">
            <h5 class="font-semibold text-purple-900 dark:text-purple-200 mb-2">üìä Logs et audit</h5>
            <ul class="text-purple-700 dark:text-purple-300 space-y-1">
              <li>‚Ä¢ <code>logs.user_id</code> ‚Üí <code>personne.id_personne</code> (SET NULL)</li>
              <li>‚Ä¢ Tra√ßabilit√© compl√®te des actions syst√®me</li>
              <li>‚Ä¢ Conservation historique pour audit et conformit√©</li>
            </ul>
          </div>
        </div>
      </div>

      <h3>Indexes et optimisations</h3>
      <p>Indexes strat√©giques pour performance des requ√™tes fr√©quentes :</p>
      
      <div class="not-prose grid md:grid-cols-2 gap-6 my-8">
        <div class="bg-indigo-50 dark:bg-indigo-950/20 rounded-xl p-6 border border-indigo-200 dark:border-indigo-800/30">
          <h4 class="font-bold text-indigo-800 dark:text-indigo-200 mb-4">üìä Indexes primaires</h4>
          <ul class="text-sm text-indigo-700 dark:text-indigo-300 space-y-2">
            <li>‚Ä¢ <strong>personne.email</strong> : UNIQUE (authentification)</li>
            <li>‚Ä¢ <strong>badge.numero</strong> : PRIMARY KEY UNIQUE</li>
            <li>‚Ä¢ <strong>message.id_groupe_message</strong> : Performance messagerie</li>
            <li>‚Ä¢ <strong>visite(id_invite, date_visite_start)</strong> : Composite planning</li>
            <li>‚Ä¢ <strong>logs.created_at</strong> : Recherche temporelle</li>
          </ul>
        </div>
        <div class="bg-teal-50 dark:bg-teal-950/20 rounded-xl p-6 border border-teal-200 dark:border-teal-800/30">
          <h4 class="font-bold text-teal-800 dark:text-teal-200 mb-4">üöÄ Indexes de performance</h4>
          <ul class="text-sm text-teal-700 dark:text-teal-300 space-y-2">
            <li>‚Ä¢ <strong>incident(statut, datetime)</strong> : Filtrage incidents</li>
            <li>‚Ä¢ <strong>badge(statut, id_proprietaire)</strong> : Recherche badges</li>
            <li>‚Ä¢ <strong>message.date_envoi</strong> : Tri chronologique</li>
            <li>‚Ä¢ <strong>suivi_badge(id_badge, date_heure)</strong> : Historique</li>
            <li>‚Ä¢ <strong>personne_groupe.derniere_connexion</strong> : Activit√© utilisateur</li>
          </ul>
        </div>
      </div>

      <!-- Configuration et maintenance -->
      <h2>Configuration et maintenance</h2>
      
      <h3>Configuration MySQL</h3>
      <p>Param√®tres optimis√©s pour performance et s√©curit√© :</p>
      
      <div class="not-prose bg-yellow-50 dark:bg-yellow-950/20 rounded-xl p-6 my-6 border border-yellow-200 dark:border-yellow-800/30">
        <h4 class="font-bold text-yellow-800 dark:text-yellow-200 mb-4">‚öôÔ∏è Param√®tres recommand√©s</h4>
        <div class="grid md:grid-cols-2 gap-4 text-sm">
          <div>
            <h5 class="font-semibold text-yellow-900 dark:text-yellow-200 mb-2">Performance</h5>
            <ul class="space-y-1 text-yellow-700 dark:text-yellow-300">
              <li>‚Ä¢ <code>innodb_buffer_pool_size</code> : 70% RAM</li>
              <li>‚Ä¢ <code>max_connections</code> : 200</li>
              <li>‚Ä¢ <code>query_cache_size</code> : 64M</li>
              <li>‚Ä¢ <code>innodb_log_file_size</code> : 256M</li>
              <li>‚Ä¢ <code>tmp_table_size</code> : 64M</li>
            </ul>
          </div>
          <div>
            <h5 class="font-semibold text-yellow-900 dark:text-yellow-200 mb-2">S√©curit√©</h5>
            <ul class="space-y-1 text-yellow-700 dark:text-yellow-300">
              <li>‚Ä¢ <code>sql_mode</code> : STRICT_TRANS_TABLES</li>
              <li>‚Ä¢ <code>local_infile</code> : 0 (d√©sactiv√©)</li>
              <li>‚Ä¢ <code>skip_symbolic_links</code> : ON</li>
              <li>‚Ä¢ <code>secure_file_priv</code> : /secure/dir</li>
              <li>‚Ä¢ SSL/TLS obligatoire pour connexions</li>
            </ul>
          </div>
        </div>
      </div>

      <h3>Strat√©gie de sauvegarde</h3>
      <p>Plan de sauvegarde robuste pour protection des donn√©es :</p>
      
      <ol>
        <li><strong>Sauvegarde compl√®te :</strong>
          <ul>
            <li>Fr√©quence : Quotidienne √† 2h00</li>
            <li>M√©thode : mysqldump avec --single-transaction</li>
            <li>Compression : gzip pour r√©duction taille</li>
            <li>Stockage : Hors site + local (7 jours)</li>
          </ul>
        </li>
        <li><strong>Sauvegarde incr√©mentale :</strong>
          <ul>
            <li>Fr√©quence : Toutes les 4 heures</li>
            <li>M√©thode : Binary logs MySQL</li>
            <li>R√©tention : 48 heures local</li>
            <li>Point-in-time recovery possible</li>
          </ul>
        </li>
        <li><strong>Tests de restauration :</strong>
          <ul>
            <li>Validation hebdomadaire automatique</li>
            <li>Environnement de test d√©di√©</li>
            <li>M√©triques de temps de restauration</li>
            <li>Documentation proc√©dures d'urgence</li>
          </ul>
        </li>
      </ol>

      <h3>Monitoring et alertes</h3>
      <p>Surveillance proactive de la sant√© de la base :</p>
      
      <div class="not-prose bg-green-50 dark:bg-green-950/20 rounded-xl p-6 my-6 border border-green-200 dark:border-green-800/30">
        <h4 class="font-bold text-green-800 dark:text-green-200 mb-4">üìà M√©triques surveill√©es</h4>
        <div class="grid md:grid-cols-2 gap-4 text-sm">
          <div>
            <h5 class="font-semibold text-green-900 dark:text-green-200 mb-2">Performance</h5>
            <ul class="space-y-1 text-green-700 dark:text-green-300">
              <li>‚Ä¢ <strong>Temps r√©ponse</strong> : < 100ms (SELECT), < 500ms (UPDATE)</li>
              <li>‚Ä¢ <strong>Connexions actives</strong> : Alert si > 150</li>
              <li>‚Ä¢ <strong>Requ√™tes lentes</strong> : Log si > 2s</li>
              <li>‚Ä¢ <strong>Buffer pool hit ratio</strong> : > 95%</li>
            </ul>
          </div>
          <div>
            <h5 class="font-semibold text-green-900 dark:text-green-200 mb-2">Ressources</h5>
            <ul class="space-y-1 text-green-700 dark:text-green-300">
              <li>‚Ä¢ <strong>Espace disque</strong> : Alert si < 20% libre</li>
              <li>‚Ä¢ <strong>CPU usage</strong> : Alert si > 80% sustained</li>
              <li>‚Ä¢ <strong>Memory usage</strong> : Monitor swap usage</li>
              <li>‚Ä¢ <strong>R√©plication lag</strong> : Alert si > 30s</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Migration et √©volution -->
      <h2>Migration et √©volution du sch√©ma</h2>
      
      <h3>Gestion des migrations Laravel</h3>
      <p>√âvolution contr√¥l√©e du sch√©ma de base de donn√©es :</p>
      
      <div class="not-prose bg-indigo-50 dark:bg-indigo-950/20 rounded-xl p-6 my-6 border border-indigo-200 dark:border-indigo-800/30">
        <h4 class="font-bold text-indigo-800 dark:text-indigo-200 mb-4">üîÑ Process de migration</h4>
        <div class="space-y-4 text-sm">
          <div class="bg-indigo-100 dark:bg-indigo-900/30 rounded-lg p-4 border border-indigo-200 dark:border-indigo-800">
            <h5 class="font-semibold text-indigo-900 dark:text-indigo-200 mb-2">1. D√©veloppement</h5>
            <ul class="text-indigo-700 dark:text-indigo-300 space-y-1">
              <li>‚Ä¢ Cr√©ation migration : <code>php artisan make:migration</code></li>
              <li>‚Ä¢ Test en local : <code>php artisan migrate</code></li>
              <li>‚Ä¢ Rollback test : <code>php artisan migrate:rollback</code></li>
              <li>‚Ä¢ Validation structure et donn√©es</li>
            </ul>
          </div>
          <div class="bg-yellow-100 dark:bg-yellow-900/30 rounded-lg p-4 border border-yellow-200 dark:border-yellow-800">
            <h5 class="font-semibold text-yellow-900 dark:text-yellow-200 mb-2">2. Staging</h5>
            <ul class="text-yellow-700 dark:text-yellow-300 space-y-1">
              <li>‚Ä¢ Copie donn√©es production vers staging</li>
              <li>‚Ä¢ Ex√©cution migration avec donn√©es r√©elles</li>
              <li>‚Ä¢ Tests complets application</li>
              <li>‚Ä¢ Validation performance queries</li>
            </ul>
          </div>
          <div class="bg-green-100 dark:bg-green-900/30 rounded-lg p-4 border border-green-200 dark:border-green-800">
            <h5 class="font-semibold text-green-900 dark:text-green-200 mb-2">3. Production</h5>
            <ul class="text-green-700 dark:text-green-300 space-y-1">
              <li>‚Ä¢ Sauvegarde compl√®te pr√©-migration</li>
              <li>‚Ä¢ Mode maintenance activ√©</li>
              <li>‚Ä¢ Migration avec monitoring</li>
              <li>‚Ä¢ Validation post-migration</li>
            </ul>
          </div>
        </div>
      </div>

      <h3>√âvolutions pr√©vues</h3>
      <p>Roadmap d'am√©lioration du sch√©ma de donn√©es :</p>
      
      <ul>
        <li><strong>Performance :</strong> Partitioning des tables logs par date</li>
        <li><strong>Audit :</strong> Tables d'audit automatique pour tra√ßabilit√©</li>
        <li><strong>Analytics :</strong> Vues mat√©rialis√©es pour reporting</li>
        <li><strong>Archive :</strong> Strat√©gie d'archivage donn√©es anciennes</li>
        <li><strong>R√©plication :</strong> Read replicas pour scalabilit√©</li>
      </ul>

      <!-- Conclusion -->
      <div class="not-prose bg-gradient-to-br from-cyan-50 to-blue-50 dark:from-cyan-950/20 dark:to-blue-950/20 rounded-2xl p-8 mt-12 border border-cyan-200/50 dark:border-cyan-800/30">
        <h2 class="text-2xl font-bold text-slate-900 dark:text-white mb-4">üíé Base de donn√©es robuste et √©volutive</h2>
        <p class="text-slate-700 dark:text-slate-300 leading-relaxed mb-6">
          Cette architecture de base de donn√©es garantit performance, int√©grit√© et s√©curit√© pour la gestion d'entreprise-r√©sidence. 
          Les optimisations et la strat√©gie de maintenance assurent une √©volutivit√© √† long terme.
        </p>
        <div class="grid md:grid-cols-3 gap-4">
          <div class="bg-white/50 dark:bg-slate-800/50 rounded-xl p-4">
            <h3 class="font-bold text-cyan-900 dark:text-cyan-200 mb-2">üîí Int√©grit√©</h3>
            <p class="text-sm text-slate-600 dark:text-slate-300">Contraintes strictes et validation</p>
          </div>
          <div class="bg-white/50 dark:bg-slate-800/50 rounded-xl p-4">
            <h3 class="font-bold text-cyan-900 dark:text-cyan-200 mb-2">‚ö° Performance</h3>
            <p class="text-sm text-slate-600 dark:text-slate-300">Indexes optimis√©s et requ√™tes rapides</p>
          </div>
          <div class="bg-white/50 dark:bg-slate-800/50 rounded-xl p-4">
            <h3 class="font-bold text-cyan-900 dark:text-cyan-200 mb-2">üîÑ √âvolutivit√©</h3>
            <p class="text-sm text-slate-600 dark:text-slate-300">Migrations contr√¥l√©es et extensibilit√©</p>
          </div>
        </div>
      </div>
    </div>
  </DocShell>
</template>

<script setup lang="ts">
import { onMounted } from 'vue'

// Import du syst√®me de th√®me
const { initTheme } = useTheme()

// Fonction de traduction utilisant les fichiers JSON i18n
const route = useRoute()
const getCurrentLocale = () => {
  const path = route.path
  if (path.startsWith('/en')) return 'en'
  if (path.startsWith('/zh')) return 'zh'
  return 'fr'
}
const locale = getCurrentLocale()

// Fonction de traduction simple
const t = (key: string) => {
  const translations: Record<string, Record<string, any>> = {
    fr: {
      'database': {
        'title': 'Base de donn√©es',
        'description': 'Structure et gestion des donn√©es'
      }
    }
  }
  
  const keys = key.split('.')
  let value = translations[locale]
  
  for (const k of keys) {
    if (value && typeof value === 'object' && k in value) {
      value = value[k]
    } else {
      return key
    }
  }
  
  return typeof value === 'string' ? value : key
}

useHead({ title: t('database.title') + ' - Documentation technique' })

onMounted(() => {
  initTheme()
})
</script>


